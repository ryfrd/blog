<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <link rel="icon" href="/image/icon.webp" type="image/icon type" -->
    
    <link href="/css/dark.css" rel="stylesheet" id="stylesheet">
    <title>james mclaren</title>
  </head>
  <body>
  <script src="https://kit.fontawesome.com/460d3298b2.js" crossorigin="anonymous"></script>
  <script src="/js/toggle.js"></script>

  <div class="nav left-right">
    <div class="left">
      <a href="/" class="title nav-left-item squishy">james mclaren</a>
      <button id="themeButton" class="toggle-button nav-left-item squishy" onclick="toggleTheme()">
<i class="fa-solid fa-circle-half-stroke"></i>
      </button>
    </div>
    <div class="right">
      
        <a class="nav-right-item squishy" href="/posts/">all posts</a>
      
        <a class="nav-right-item squishy" href="/tags/">topics</a>
      
    </div>
  </div>
  
  <div class="body-container">


<div class="body-container">
  <h3>learning about qtile widgets via the medium of cricket</h3>
  <p>I&rsquo;m a person who has spent an unreasonable amount of time making minute changes to the appearance of my bar in qtile. Despite the very nice selection of widgets availabe by default with qtile, it was only a matter of time before I decided I wanted to experiment with making my own custom widget. Fortunately, if you can do a bit of python this is quite an approachable undertaking.</p>
<p>The dream widget I was lacking was a little live crikcet score ticker type thing; something which would scroll along on my bar showing me the score in live cricket matches. I&rsquo;m sure this will interest very few people but I learnt some good stuff along the way.</p>
<h3 id="hello-world">Hello World?!</h3>
<p>As far as I can tell from looking at the code for some of the <a href="https://github.com/qtile/qtile/tree/master/libqtile/widget">built-in widgets</a> and <a href="https://docs.qtile.org/en/latest/manual/howto/widget.html">this very helpful guide</a>, a basic hello world widget would look something like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fe8019">from</span> libqtile.widget <span style="color:#fe8019">import</span> base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">class</span> HelloWorld(base<span style="color:#fe8019">.</span>_TextBox):
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> __init__(self, <span style="color:#fe8019">**</span>config):
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">super</span>()<span style="color:#fe8019">.</span>__init__(<span style="color:#b8bb26">&#34;&#34;</span>, <span style="color:#fe8019">**</span>config)
</span></span><span style="display:flex;"><span>        self<span style="color:#fe8019">.</span>text <span style="color:#fe8019">=</span> <span style="color:#b8bb26">&#39;Hello world!&#39;</span>
</span></span></code></pre></div><p>Qtile provides a selection of base widget classes to do various useful things. This example uses the simple <code>_TextBox</code> which displays the content of the <code>self.text</code> property.</p>
<h3 id="hello-world-version-2">Hello World Version 2</h3>
<p>Very nice, but for the cricket widget we&rsquo;ll need something which lets us update the text. The answer is <code>ThreadPoolText</code>. This class lets you periodically update the text by overridding its <code>poll</code> method with a function that returns the updated text.</p>
<p>This example updates itself with hello world in a different language every five seconds.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fe8019">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">class</span> HolaMundo(base<span style="color:#fe8019">.</span>ThreadPoolText):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    defaults <span style="color:#fe8019">=</span> [
</span></span><span style="display:flex;"><span>        (<span style="color:#b8bb26">&#34;update_interval&#34;</span>, <span style="color:#d3869b">5</span>, <span style="color:#b8bb26">&#34;Update interval for the widget&#34;</span>),
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> __init__(self, <span style="color:#fe8019">**</span>config):
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">super</span>()<span style="color:#fe8019">.</span>__init__(<span style="color:#b8bb26">&#34;&#34;</span>, <span style="color:#fe8019">**</span>config)
</span></span><span style="display:flex;"><span>        self<span style="color:#fe8019">.</span>add_defaults(HolaMundo<span style="color:#fe8019">.</span>defaults)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> <span style="color:#fabd2f">poll</span>(self):
</span></span><span style="display:flex;"><span>        messages <span style="color:#fe8019">=</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#b8bb26">&#39;Hola mundo&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#b8bb26">&#39;Ciao mondo&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#b8bb26">&#39;مرحبا بالعالم&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#b8bb26">&#39;Saluton Mondo&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#b8bb26">&#39;Sawubona Mhlaba&#39;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">return</span> random<span style="color:#fe8019">.</span>choice(messages)
</span></span></code></pre></div><p>Along with the whole poll thing, this example also introduces <code>defaults</code>. This is a list of tuples which define parameters that the user can configure. Here we&rsquo;ve added <code>update_interval</code> which defines how often the widget is updated.</p>
<h3 id="cricket-scores">Cricket Scores</h3>
<p>For getting the cricket scores we&rsquo;ll be using a handy rss feed from cricinfo so no brute force scraping will be required, just my beloved <a href="https://pypi.org/project/feedparser/">feedparser</a>. This doesn&rsquo;t involve anything directly widget related, just massaging the rss feed into something that would look useful on your bar. Anyway, this is what the finished item looked like.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fe8019">from</span> libqtile.widget <span style="color:#fe8019">import</span> base
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> feedparser
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">class</span> CricketScores(base<span style="color:#fe8019">.</span>ThreadPoolText):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    defaults <span style="color:#fe8019">=</span> [
</span></span><span style="display:flex;"><span>        (<span style="color:#b8bb26">&#34;update_interval&#34;</span>, <span style="color:#d3869b">60</span>, <span style="color:#b8bb26">&#34;Update interval for the cricket scores widget&#34;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b8bb26">&#34;teams&#34;</span>,[],<span style="color:#b8bb26">&#34;Teams to display scores for&#34;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b8bb26">&#34;separator&#34;</span>,<span style="color:#b8bb26">&#34; </span><span style="color:#b8bb26">\U0001F3CF</span><span style="color:#b8bb26"> &#34;</span>,<span style="color:#b8bb26">&#34;Text to place between scores&#34;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b8bb26">&#34;no_scores_string&#34;</span>,<span style="color:#b8bb26">&#34;&#34;</span>,<span style="color:#b8bb26">&#34;Text to show when there are no scores to show&#34;</span>),
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> __init__(self, <span style="color:#fe8019">**</span>config):
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">super</span>()<span style="color:#fe8019">.</span>__init__(<span style="color:#b8bb26">&#34;&#34;</span>, <span style="color:#fe8019">**</span>config)
</span></span><span style="display:flex;"><span>        self<span style="color:#fe8019">.</span>add_defaults(CricketScores<span style="color:#fe8019">.</span>defaults)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> <span style="color:#fabd2f">get_scores</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#928374;font-style:italic"># parse rss feed and get </span>
</span></span><span style="display:flex;"><span>        <span style="color:#928374;font-style:italic"># live matches from title field</span>
</span></span><span style="display:flex;"><span>        feed <span style="color:#fe8019">=</span> feedparser<span style="color:#fe8019">.</span>parse(<span style="color:#b8bb26">&#34;http://static.cricinfo.com/rss/livescores.xml&#34;</span>)
</span></span><span style="display:flex;"><span>        scores <span style="color:#fe8019">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">for</span> <span style="color:#fe8019">match</span> <span style="color:#fe8019">in</span> feed<span style="color:#fe8019">.</span>entries:
</span></span><span style="display:flex;"><span>            <span style="color:#928374;font-style:italic"># filter live matches</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fe8019">if</span> <span style="color:#b8bb26">&#34;*&#34;</span> <span style="color:#fe8019">in</span> <span style="color:#fe8019">match</span><span style="color:#fe8019">.</span>title:
</span></span><span style="display:flex;"><span>                scores<span style="color:#fe8019">.</span>append(<span style="color:#fe8019">match</span><span style="color:#fe8019">.</span>title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#928374;font-style:italic"># remove scores not involving chosen teams</span>
</span></span><span style="display:flex;"><span>        filtered_scores <span style="color:#fe8019">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">for</span> score <span style="color:#fe8019">in</span> scores:
</span></span><span style="display:flex;"><span>            <span style="color:#fe8019">for</span> team <span style="color:#fe8019">in</span> self<span style="color:#fe8019">.</span>teams:
</span></span><span style="display:flex;"><span>                <span style="color:#fe8019">if</span> team <span style="color:#fe8019">in</span> score:
</span></span><span style="display:flex;"><span>                    filtered_scores<span style="color:#fe8019">.</span>append(score)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#928374;font-style:italic"># if no scores, show no_scores_string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">if</span> <span style="color:#fabd2f">len</span>(filtered_scores) <span style="color:#fe8019">==</span> <span style="color:#d3869b">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#fe8019">return</span> self<span style="color:#fe8019">.</span>no_scores_string 
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#928374;font-style:italic"># form pretty string with separators</span>
</span></span><span style="display:flex;"><span>            final_scores <span style="color:#fe8019">=</span> <span style="color:#b8bb26">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fe8019">for</span> score <span style="color:#fe8019">in</span> filtered_scores:
</span></span><span style="display:flex;"><span>                <span style="color:#fe8019">if</span> score <span style="color:#fe8019">!=</span> filtered_scores[<span style="color:#fe8019">-</span><span style="color:#d3869b">1</span>]:
</span></span><span style="display:flex;"><span>                    final_scores <span style="color:#fe8019">+=</span> score <span style="color:#fe8019">+</span> self<span style="color:#fe8019">.</span>separator
</span></span><span style="display:flex;"><span>                <span style="color:#fe8019">else</span>:
</span></span><span style="display:flex;"><span>                    final_scores <span style="color:#fe8019">+=</span> score
</span></span><span style="display:flex;"><span>            <span style="color:#fe8019">return</span> final_scores
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">def</span> <span style="color:#fabd2f">poll</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fe8019">return</span> get_scores()
</span></span></code></pre></div><h3 id="actaully-using-it-in-your-config">Actaully Using It In Your Config</h3>
<p>Assuming you have a <code>my_widget.py</code> file in the same directory as your <code>config.py</code>, you simply have to import it and add it your list of widgets.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fe8019">from</span> my_widget <span style="color:#fe8019">import</span> LovelyWidget
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>screens <span style="color:#fe8019">=</span> [
</span></span><span style="display:flex;"><span>    Screen(
</span></span><span style="display:flex;"><span>        top <span style="color:#fe8019">=</span> bar<span style="color:#fe8019">.</span>Bar(
</span></span><span style="display:flex;"><span>            widgets <span style="color:#fe8019">=</span> [
</span></span><span style="display:flex;"><span>                LovelyWidget(),
</span></span><span style="display:flex;"><span>                widget<span style="color:#fe8019">.</span>GroupBox(),
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Happy widget writing.</p>

</div>

<footer>
  <small>
    <div class="foot-message">made with <a href="https://gohugo.io">hugo</a> and <a href="https://github.com/ryfrd/hugo-goose">hugo-goose</a></div>
  </small>
</footer>
</div> 
</body>
</html>

