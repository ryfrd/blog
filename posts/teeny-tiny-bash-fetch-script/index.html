<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <link rel="icon" href="/image/icon.webp" type="image/icon type" -->
    
    <link href="/css/dark.css" rel="stylesheet" id="stylesheet">
    <title>james mclaren</title>
  </head>
  <body>
  <script src="https://kit.fontawesome.com/460d3298b2.js" crossorigin="anonymous"></script>
  <script src="/js/toggle.js"></script>

  <div class="nav left-right">
    <div class="left">
      <a href="/" class="title nav-left-item squishy">james mclaren</a>
      <button id="themeButton" class="toggle-button nav-left-item squishy" onclick="toggleTheme()">
<i class="fa-solid fa-circle-half-stroke"></i>
      </button>
    </div>
    <div class="right">
      
        <a class="nav-right-item squishy" href="/posts/">all posts</a>
      
        <a class="nav-right-item squishy" href="/tags/">topics</a>
      
    </div>
  </div>
  
  <div class="body-container">


<div class="body-container">
  <h3>teeny tiny bash fetch script</h3>
  <p>This is my attempt at a neofetch, pfetch, whateverfetch style system info utility. My main concern was making something which looked nice, was easily configurable, and as portable as possible (I didn&rsquo;t really try that hard with the portability). I didn&rsquo;t think much about performance; I&rsquo;m personally not a man who stresses too much when a command takes a quarter of a second instead of a tenth. The basic gameplan was to get an array of bash commands which would fetch various bits and bobs, then loop through this array formatting the text with ANSI escape codes. First things first, this was the associative array I came up with:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#fabd2f">declare</span> -A fetch<span style="color:#fe8019">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>user<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span>$USER<span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>host<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>cat /etc/hostname<span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>uptime<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>uptime | awk <span style="color:#b8bb26">&#39;{print $3}&#39;</span> | sed <span style="color:#b8bb26">&#39;s/:/h / ; s/,/m/&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>kernel<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>awk <span style="color:#b8bb26">&#39;{print $3}&#39;</span> /proc/version<span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>distro<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>sed -n <span style="color:#b8bb26">&#39;s/^PRETTY_NAME=&#34;//p&#39;</span> /etc/os-release | sed <span style="color:#b8bb26">&#39;s/&#34;//&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>shell<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>basename $SHELL<span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>de<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span>$XDG_CURRENT_DESKTOP<span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>terminal<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span>$TERM<span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>editor<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span>$EDITOR<span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>root<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>df -Th / | tail -n <span style="color:#d3869b">1</span> | awk <span style="color:#b8bb26">&#39;{print $6}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">,
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">            </span><span style="color:#fe8019">$(</span>df -Th / | tail -n <span style="color:#d3869b">1</span> | awk <span style="color:#b8bb26">&#39;{print $2}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>ip<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>host myip.opendns.com resolver1.opendns.com |
</span></span><span style="display:flex;"><span>          tail -n <span style="color:#d3869b">1</span> | awk <span style="color:#b8bb26">&#39;{print $4}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>battery<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>cat /sys/class/power_supply/BAT0/capacity<span style="color:#fe8019">)</span><span style="color:#b8bb26">%&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>cpu<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>sed -n 5p /proc/cpuinfo | cut -d: -f2<span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>ram<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>free -h | sed -n 2p | awk <span style="color:#b8bb26">&#39;{print $3}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26"> /
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">           </span><span style="color:#fe8019">$(</span>free -h | sed -n 2p | awk <span style="color:#b8bb26">&#39;{print $2}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>swap<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>free -h | sed -n 3p | awk <span style="color:#b8bb26">&#39;{print $3}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26"> /
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">            </span><span style="color:#fe8019">$(</span>free -h | sed -n 3p | awk <span style="color:#b8bb26">&#39;{print $2}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fe8019">[</span>display<span style="color:#fe8019">]=</span><span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>xrandr | grep <span style="color:#b8bb26">&#39;*&#39;</span> | awk <span style="color:#b8bb26">&#39;{print $1}&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">, 
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    	       </span><span style="color:#fe8019">$(</span>xrandr | grep <span style="color:#b8bb26">&#39;*&#39;</span> | awk <span style="color:#b8bb26">&#39;{print $2}&#39;</span> | sed <span style="color:#b8bb26">&#39;s/*/Hz/ ; s/+//&#39;</span><span style="color:#fe8019">)</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">)</span>
</span></span></code></pre></div><p>Each of these elements fetches a differenet piece of info. You could just use environment variables to get quite a few things (user), some were an issue of grabbing a particular piece of info from a file (distro name), and some of the more complicated ones I just reformatted output from other commands (ram usage).</p>
<p>Next order of business: colors. I wanted to put a chunk or randomly colored text at the start of each line so that each time you ran the command you got something that looked a little different. I made this array of escape codes each one referring to a different bold color:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#fabd2f">declare</span> -a colors<span style="color:#fe8019">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;30m&#34;</span> <span style="color:#928374;font-style:italic"># black</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;31m&#34;</span> <span style="color:#928374;font-style:italic"># red</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;32m&#34;</span> <span style="color:#928374;font-style:italic"># green</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;33m&#34;</span> <span style="color:#928374;font-style:italic"># blue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;34m&#34;</span> <span style="color:#928374;font-style:italic"># yellow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;35m&#34;</span> <span style="color:#928374;font-style:italic"># pink</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;36m&#34;</span> <span style="color:#928374;font-style:italic"># magenta</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;\e[0;1;37m&#34;</span> <span style="color:#928374;font-style:italic"># white</span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">)</span>
</span></span></code></pre></div><p>I then repurposed a nice function from someone on stackoverflow to get a random element from this array. The variable &lsquo;pre&rsquo; here is the text that I want formatted:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pre<span style="color:#fe8019">=</span><span style="color:#b8bb26">&#34;-&gt;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>random_color <span style="color:#fe8019">()</span> <span style="color:#fe8019">{</span>
</span></span><span style="display:flex;"><span>    size<span style="color:#fe8019">=</span><span style="color:#b8bb26">${#</span>colors[@]<span style="color:#b8bb26">}</span>
</span></span><span style="display:flex;"><span>    index<span style="color:#fe8019">=</span><span style="color:#fe8019">$((</span>$RANDOM <span style="color:#fe8019">%</span> $size<span style="color:#fe8019">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fabd2f">echo</span> <span style="color:#b8bb26">&#34;</span><span style="color:#b8bb26">${</span>colors[$index]<span style="color:#b8bb26">}${</span>pre<span style="color:#b8bb26">}</span><span style="color:#b8bb26">\e[0m&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">}</span>
</span></span></code></pre></div><p>My plan was then to simply loop through the array, &rsquo;echo-ing&rsquo; out the random_color function, the key from the fetch array, a separator, and then the value form the fetch array. This worked mainly, the only issue being that each element from the fetch was not printed in the order it was declared. Ideally, I wanted the fetch elements to be printed in the order they were put in the array so you could configure the how they appeared. Once again my primitive understanding of bash had let me down; I turned to stackoverflow. I found the solution was to define another array containing the fetch keys and then use it to attack the other associative &lsquo;fetch&rsquo; array:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#fabd2f">declare</span> -a order<span style="color:#fe8019">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;user&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;host&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;uptime&#34;</span> <span style="color:#928374;font-style:italic"># uses uptime command</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;kernel&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;distro&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;shell&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;de&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;terminal&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b8bb26">&#34;editor&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;ip&#34; # uses host command</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;cpu&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;ram&#34; # uses free command</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;swap&#34; # uses free also</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;root&#34; # uses df command</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;battery&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#928374;font-style:italic"># &#34;display&#34; # uses xrandr</span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">for</span> info in <span style="color:#b8bb26">&#34;</span><span style="color:#b8bb26">${</span>order[@]<span style="color:#b8bb26">}</span><span style="color:#b8bb26">&#34;</span>; <span style="color:#fe8019">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fabd2f">echo</span> -e <span style="color:#b8bb26">&#34;</span><span style="color:#fe8019">$(</span>random_color<span style="color:#fe8019">)</span><span style="color:#b8bb26"> \e[0;1;3m</span>$info<span style="color:#b8bb26">\e[0m</span><span style="color:#b8bb26">${</span>sep<span style="color:#b8bb26">}${</span>fetch[$info]<span style="color:#b8bb26">}</span><span style="color:#b8bb26">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">done</span>
</span></span></code></pre></div><p>This had the happy unintended consequence of allowing you to very easily configure which items you wanted in the fetch by simply commenting out keys from the order array. You can check out the script in its entirety <a href="https://gitlab.com/robbygozzarder/golazo">here</a>. This is a pretty picture of a few variations.</p>
<p><img src="/image/golazo.png" alt="golazo"></p>

</div>

<footer>
  <small>
    <div class="foot-message">made with <a href="https://gohugo.io">hugo</a> and <a href="https://github.com/ryfrd/hugo-goose">hugo-goose</a></div>
  </small>
</footer>
</div> 
</body>
</html>

